第10章 比特币安全
===============

保证比特币的安全是一个挑战，因为比特币不像银行账户的余额，不是价值的抽象体现。比特币与数字现金或黄金很像。你可能听说过这样一种说法：“衙门口朝南开,有理没钱别进来”。嗯，在比特币中，道理是一样的，拥有密钥解锁比特币与拥有现金或贵金属是等价的。你可把它们弄丢，放错地方，被盗，或者不小心给错了金额。不管哪种情况，都是没法追索回来的，正如你把现金丢到了马路上。

但是，比特币也有现金、黄金或银行账户所不具备的功能。存放密钥的比特币钱包可以像任何普通文件一样进行备份处理。可以存储多个拷贝，甚至可以打印在纸张上进行备份。你肯定无法“备份”现金、黄金或者银行账户。比特币与原有货币的差异是如此巨大，我们不得不用一种崭新的思路来考虑其安全性问题。

# 安全原则

比特币的核心原则是去中心化，这一点对其安全非常重要。在一个中心化的模型中，比如传统银行或支付网络，安全性依赖于访问控制和审查，这可以把坏蛋挡在系统之外。作为比较，在一个类似比特币这样的去中心化系统中，将维护系统安全的责任及控制权都交给了用户。因为比特币网络的安全是基于工作量证明，而不是访问控制，因此网络可以是开放的，数据流量本身也不需要进行加密。

在一个传统的支付网络中，比如信用卡系统，支付是开放式的，因为交易本身包含了用户的私人身份信息（信用卡账号）。第一次刷卡完成后，任何能访问卡信息的人都可以一次又一次的从账户上“拉取”资金，向用户收费。因此支付网络必须对端到端的通信进行加密，以确保任何监听者或中间环节无法在支付数据传输或存储的过程中截获交易信息。如果一个坏人获得了访问系统的权限，他就可以截获当前的交易信息和支付令牌，这些信息就可以用于伪造交易。更糟糕的，一旦客户信息泄露，客户的个人身份信息暴露在盗窃者眼皮底下。客户这时必须立即采取措施，以防失窃帐户被盗窃者用于欺诈。

比特币则完全不同。一个比特币交易仅仅只是授权向特定接收者发送特定价值的比特币，交易无法伪造也不能修改。不会泄露任何个人信息，比如当事人身份等，也无法用于授权其他支付。因此，比特币支付网络不需要进行加密也不需防范窃听。实际上，你可以在诸如不安全的WiFi或者蓝牙等开放的公共网络上广播比特币交易信息，而比特币交易的安全性并不会降低。

比特币的去中心化安全模型将大量权利交到了用户手中。伴随着权利而来的是维护密钥安全的责任。对大多数用户来说，做到这个并不容易，特别是在通用用途计算设备上，比如联网的智能手机或笔记本电脑。虽然比特币的去中心化模型防止了像信用卡一样大量用户信息泄露的风险，但还是有很多用户无法保证其密钥安全，被黑客盗取。

# 开发安全的比特币系统

对比特币开发者来说，最重要的原则就是去中心化。大多数开发者都了解中心化安全模型，也愿意将这些模型应用到比特币应用程序中，但最终都无功而返。

比特币的安全依赖于密钥的去中心化控制和矿工们独立的交易验证。如果想利用比特币的安全性，你需要确保你仍处于比特币的安全模型中。简而言之：不要让用户对密钥失去控制，不要让交易脱离区块链。

举例来说，很多早期的比特币交易系统将所有用户的资金集中在一个包含私钥的“热”钱包内，钱包数据则存储在单一的服务器上。这样一种设计，剥夺了用户的控制权，并将代表控制权的密钥集中存储在一台服务器上。很多这种系统都被黑客攻击过，并给客户带来了灾难性的损失。

另外，一个常见的错误行为是进行“离链”交易，试图降低交易费用或者提高交易处理效率。“离链”系统会在其内部中心化的账本中记录交易信息，仅仅不定期的与比特币区块链进行同步。这种做法再次将去中心化的比特币安全机制替换为专有的中心化的方式。当交易离开区块链时，未恰当做好安全防范措施的中心化账本可能会不知不觉就被篡改，资金被转移、占用。

除非你打算投入大量财力物力到运营安全上，比如进行多层的访问控制，严格的事后审计（正如传统银行做的那样），想将资金从比特币的去中心化安全场景中剥离出来，都必须慎之又慎。甚至你有足够的资金和条例去创建一个强壮的安全模型，这样的设计也仅仅是复制了一个脆弱的，账户易受窃取的传统金融网络，深受贪污和挪用困扰。要想充分利用比特币特有的去中心化安全模型，你必须避免中心化架构的诱惑，虽然这种架构你会感到熟悉，但它终将摧毁比特币的安全性。

# 信任根

传统安全架构是基于一种叫做*信任根（root of trust）*的概念，它是一种用作系统或应用安全基础的可信核心。安全架构围绕着信任根开发，如同一系列同心圆，或者层层包裹的洋葱，围绕着中心逐层向外扩展。每一层都建立在更可信的内层之上，方法包括访问控制，数字签名，加密以及其他安全原语等。随着软件系统变得更加复杂，隐含bug的可能性也越高，安全威胁也随之增多。结果就是系统越复杂，越难保证安全。信任根的概念确保大多数信任被置于系统复杂度最低的部分，也是系统中安全风险最小的部分，更复杂的软件则在其上构建。这种安全架构可以在不同规模的系统中复用，首先在单一系统的硬件层建立一个信任根，然后不断向上扩展信任根，先是操作系统，然后更高层的系统服务，最终形成了一个个围绕着信任根，信任递减的同心圆。

比特币的安全架构与这不同。在比特币中，共识系统创建了一个可信的并且完全去中心化的公共账本。一个得到正确验证的区块链使用创世区块作为信任根，创建了一条一直延伸到当前区块的信任链。比特币系统可以也必须使用区块链作为它们的信任根。当设计一个复杂的，需要在多个系统上提供服务的比特币应用时，你需要非常仔细的去审查其安全架构，以确定信任  