第10章 比特币安全
===============

保证比特币的安全是一个挑战，因为比特币不像银行账户的余额，不是价值的抽象体现。比特币与数字现金或黄金很像。谚语说：“现实占有，十诉九胜”。在比特币中，这个谚语应该叫做“现实占有，十诉十胜”。拥有密钥解锁比特币与拥有现金或贵金属是等价的。你会把它们弄丢，放错地方，被盗，或者不小心给错了金额。不管哪种情况，都是没法追索回来的，正如你把现金丢到了马路上，谁捡到就是谁的了。

但是，比特币也有现金、黄金或银行账户所不具备的功能。存放密钥的比特币钱包可以像任何普通文件一样进行备份处理。可以存储多个拷贝，甚至可以打印在纸张上进行备份。你肯定无法“备份”现金、黄金或者银行账户。比特币与普通货币的差异是如此巨大，我们不得不用一种崭新的思路来考虑其安全性问题。

## 安全原则

比特币的核心原则是去中心化，这一点对其安全非常重要。在一个诸如传统银行或支付网络等中心化的模型中，安全性依赖于访问控制和审查，这可以把坏蛋挡在系统之外。作为比较，在一个类似比特币的去中心化系统中，将维护系统安全的责任及控制权都交给了用户。因为比特币网络的安全是基于工作量证明，而不是访问控制，因此网络可以是开放的，数据流量本身也不需要进行加密。

在一个传统的支付网络中，比如信用卡系统，支付是开放式的，因为交易本身包含了用户的私人身份信息（信用卡账号）。第一次刷卡完成后，任何能访问卡信息的人都可以一次又一次的从账户上“拉取”资金，向用户收费。因此支付网络必须对端到端的通信进行加密，确保监听者或中间环节无法在支付数据传输或存储的过程中截获交易信息。如果一个坏人获得了访问系统的权限，他就可以截获当前的交易信息和支付令牌，这些信息可以用于伪造交易。更糟糕的，一旦客户信息泄露，客户的个人身份信息暴露在盗窃者眼皮底下。客户这时必须立即采取措施，以防失窃帐户被盗窃者用于欺诈。

比特币则完全不同。一个比特币交易仅仅授权向特定接收者发送特定价值的比特币，交易无法伪造也不能修改。不会泄露任何个人信息，比如当事人身份等，也无法用于授权其他支付交易。因此，比特币支付网络不需要进行加密也不需防范窃听。实际上，你可以在诸如不安全的WiFi或者蓝牙等开放的公共网络上广播比特币交易信息，而比特币交易的安全性并不会降低。

比特币的去中心化安全模型将大量权利交到了用户手中。伴随着权利而来的是维护密钥安全的责任。对大多数用户来说，做到这个并不容易，特别是在通用用途计算设备上，比如联网的智能手机或笔记本电脑。虽然比特币的去中心化模型防止了像信用卡一样大量用户信息泄露的风险，但还是有很多用户无法保证其密钥安全，被黑客盗取。

### 开发安全的比特币系统

对比特币开发者来说，最重要的原则就是去中心化。大多数开发者都了解中心化安全模型，也愿意将这些模型应用到比特币应用程序中，但最终都无功而返。

比特币的安全依赖于密钥的去中心化控制和矿工们独立的交易验证。如果想利用比特币的安全特性，你需要确保你仍处于比特币的安全模型中。简而言之：不要让用户对密钥失去控制，不要让交易脱离区块链。

举例来说，很多早期的比特币交易系统将所有用户的资金集中在一个包含私钥的“热”钱包内，钱包数据则存储在单一的服务器上。这样一种设计，剥夺了用户的控制权，并将代表控制权的密钥集中存储在一台服务器上。很多这种系统都被黑客攻击过，并给客户带来了灾难性的损失。

另外，一个常见的错误行为是进行“离链”交易，试图降低交易费用或者提高交易处理效率。“离链”系统会在其内部中心化的账本中记录交易信息，仅仅不定期的与比特币区块链进行同步。这种做法再次将去中心化的比特币安全机制替换为专有的中心化的方式。当交易离开区块链时，未恰当做好安全防范措施的中心化账本可能会不知不觉就被篡改，资金被转移、占用。

除非你打算投入大量财力物力到运营安全上，比如进行多层的访问控制，严格的事后审计（正如传统银行做的那样），想将资金从比特币的去中心化安全场景中剥离出来，都必须慎之又慎。甚至你有足够的资金和条例去创建一个强壮的安全模型，这样的设计也仅仅是复制了一个脆弱的，账户易受窃取的传统金融网络，深受贪污和挪用困扰。要想充分利用比特币特有的去中心化安全模型，你必须避免中心化架构的诱惑，虽然这种架构你会感到熟悉，但它终将摧毁比特币的安全性。

### 信任根

传统安全架构是基于一种叫做*信任根（root of trust）*的概念，它是一种用作系统或应用安全基础的可信核心。安全架构围绕着信任根开发，如同一系列同心圆，或者层层包裹的洋葱，围绕着中心逐层向外扩展。每一层都建立在更可信的内层之上，方法包括访问控制，数字签名，加密以及其他安全原语等。随着软件系统变得更加复杂，隐含bug的可能性也越高，安全威胁也随之增多。结果就是系统越复杂，越难保证安全。信任根的概念确保大多数信任被置于系统复杂度最低的部分，也是系统中安全风险最小的部分，更复杂的软件则在其上构建。这种安全架构可以在不同规模的系统中复用，首先在单一系统的硬件层建立一个信任根，然后不断向上扩展信任根，先是操作系统，然后更高层的系统服务，最终形成了一个个围绕着信任根，信任递减的同心圆。

比特币的安全架构与这不同。在比特币中，共识系统创建了一个可信的并且完全去中心化的公共账本。一个得到正确验证的区块链使用创世区块作为信任根，创建了一条一直延伸到当前区块的信任链。比特币系统可以也必须使用区块链作为它们的信任根。当设计一个复杂的，需要在多个系统上提供服务的比特币应用时，你需要非常仔细的去审查其安全架构，以弄清信任放置在何处。最终，唯一需要明确信任的是一条完整验证过的区块链。如果应用显性或隐性的信赖除了区块链之外的任何东西，这就需要引起关注，因为这可能就是系统最脆弱之处。一个评估应用安全架构的良好的方法是单独考量每个组件，设想该组件被完全攻破并被入侵者控制的场景。依次取出应用程序的每个组件，评估它被破坏时对整体安全造成的影响。如果你的应用程序在该组件被破坏时不再安全，那就说明你不该将信任放置在这个组件中。一个没有漏洞的比特币应用程序应该只受限于比特币的共识机制，意味着信任根是基于比特币系统安全架构最坚固的部分。

大量被黑客攻击的比特币交易所的例子说明了这一点的重要性，因为这些系统的安全架构和设计连最基本的检查都无法通过。这些中心化的实现方式将信任置于比特币区块链之外的组件上，比如热钱包，中心化的账本数据库，脆弱的加密密钥，以及类似的其他方案。

# 用户安全最佳实践

人类已经使用了几千年的物理安全控制手段。相对的，我们在数字安全上的经验还不到50年。现代的通用用途操作系统并不十分安全，并不特别适合保存数字货币。我们的计算机因保持与互联网的连接而持续地暴露在外部的威胁当中。这些计算机上运行着不同人写的成百上千的软件组件，通常都可以不受限制的访问用户的文件。在这些众多的软件当中，只要存在一个流氓软件，就能截获你的键盘输入，非法入侵文件，盗取钱包软件中保存的比特币。要达到免受病毒、木马的影响，所需的计算机维护水平以超过了大多数用户所拥有的技能要求。

虽然信息安全的研究和发展已进行了几十年，但是数字资产仍然极易受到攻击。即使受到最高等级防护和限制的系统，比如金融服务企业，情报机构，防务承包商也仍然经常受到攻击。比特币创建了带有固有价值的数字资产，这些资产被窃取时可以立即并不可撤销的转移到新的用户。这对黑客来说是一个巨大的刺激。直到现在，黑客都是通过盗取身份信息或者账户令牌来获取资产，比如信用卡，银行账号等。面对金融信息的掩饰和洗钱的困难，我们看到的是不断升级的盗窃行为。比特币加剧了这个问题，因为它不需要掩饰和洗钱，它本身就是拥有内在价值的数字资产。

幸运的是，比特币也创造了一种提高计算机安全的激励机制。相对之前模糊和间接的计算机风险，比特币使得这些风险清晰明显。在机器上保存比特币使得用户将其注意力集中到提高机器安全性的需求上来。其直接结果就是比特币和其他数字货币在越来越多的领域被接受使用。我们看到不管是黑客技术还是安全解决方案都得到了提升。简单来说，黑客现在有了一个非常诱人的目标，而用户也有了清晰的认识来保护自己。

在过去的三年中，随着比特币不断被采纳，一个直接结果是，在信息安全领域的取得了一系列巨大的创新，比如硬件加密，秘钥存储和硬件钱包，多签名技术，数字契约等。在接下来的几节中，我们将讨论几种实用用户安全的最佳实践。

## 物理比特币存储

相对信息安全，大多数用户对于物理安全都感觉更加顺手，因此一种非常有效的保护比特币安全的方法是将它们转化为物理形式。比特币密钥仅仅是一串长长的数字。这意味着它们可以以物理的形式进行存储，比如打印到纸上或者刻制到硬币上。保证密钥安全就变成了简单的物理保护打印的比特币密钥的安全。一系列打印在纸张上的密钥称作“纸钱包”，很多免费的工具可以用来打印纸钱包。我自己的做法是将绝大多数（99%以上）的比特币保存在使用BIP0038来进行加密的纸钱包上，这些纸钱包复制多份，锁进保险柜。将比特币保存在线下的方式叫做“冷存储”，是最高效的安全技术之一。冷存储系统是一种通过离线系统（永远不与互联网相连的系统）生成密钥，并离线存储在纸张、数字介质（比如U盘）的系统。

## 硬件钱包

从长远来看，比特币安全会越来越多的以硬件防篡改钱包的形式出现。不像智能电话或者桌面电脑，比特币的硬件钱包只有一个目的：安全的存储比特币。由于没有可被攻击的通用用途软件，仅提供有限接口，硬件钱包可以为非专业用户提供几乎万无一失的安全级别。我希望能看到硬件钱包成为比特币存储的主要形式。Trezor是这类硬件钱包的一个例子。

## 平衡风险

虽然大多数用户都能正确认识比特币盗窃，但是还有一个更大的风险。数据文件随时都可能丢失。如果文件中包含比特币，一旦丢失就会更加痛苦。在包含比特币钱包的努力中，用户必须非常小心以免走过头以致丢失比特币。在2010年夏，一个著名的比特币认知和教育项目丢失了将近7000个比特币。他们在防范盗窃的过程中，实现了一系列复杂的加密备份。但是最终他们却把加密的密钥给弄丢了，备份变得一文不值，财富也白白丢失了。如果保护措施太过头，就像把钱埋在沙漠中，虽然安全了，但也有可能永远都无法再找回来了。

## 分散风险

你会将全部家当换成现金放在钱包里随身携带吗？大多数人都会认为这是鲁莽的行为，但是比特币用户却经常将他们的全部比特币放在同一个钱包里。实际上，用户应该将比特币存放在多个不同的钱包里，从而达到分散风险的目的。明智的用户只会将小额的比特币存放在在线或移动钱包中当作零钱使用，金额一般小于全部比特币金额的5%。剩下的部分则拆分后存储在不同的介质中，比如电脑钱包，离线钱包（冷存储）等。

## 多重签名和治理

当一个公司或个人存储大量比特币时，他们最好考虑使用多重签名比特币地址。使用多重签名地址，用户支付时必须同时提供多个签名，这很好的保护了资金的安全。签名密钥必须存储在几个不同的地点，并由不同的人进行控制。比如，在公司环境中，密钥必须由多个公司高管独立生成并分别保管，确保没有一个人可以单独对资金安全造成威胁。多重签名在某些情况下，也能提供冗余的功能，比如，在一人拥有多个地址并且存储在不同地点的情况。

## 生存能力

一个重要的却经常被忽视的安全考虑是可用性，特别是在密钥拥有者失能或死亡的情况下。比特币用户被告知应该使用复杂的密码，并将其密钥存放在安全和隐蔽的地方，不跟任何人分享。不幸的是，当用户无法对比特币进行解锁时，他的家庭成员几乎无法恢复任何资金。实际上，在大多数情况下，比特币用户的家庭可能根本就不知道这笔比特币资金的存在。

如果你有很多比特币，你应该考虑与可信任的亲属或者律师共享解密资金的细节。一个更复杂的比特币生存计划，可以与作为专业的“数字资产执行者”的律师一起设置多重签名，并做好遗产规划。

# 总结

比特币是一个全新的，史无前例的，复杂的技术。随着时间的推移，我们将开发出更好的安全工具和实践，使得非专业用户更容易使用。现在，比特币用户可以使用这里讨论的一些技巧，享受安全无忧的比特币体验。