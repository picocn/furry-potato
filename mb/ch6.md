第6章  比特币网络
========

#点对点网络架构

比特币是建立在互联网之上的一种点对点网络架构。名词点对点（或者P2P）的含义是所有加入这个网络的计算机互为对等，所有的节点都一样，没有“特殊”节点，所有节点共同担当起提供网络服务的责任。网络节点间以一种“扁平”的网状拓扑结构互联。在点对点网络中的节点同时提供和消费服务，它们间互惠互利。P2P网络具有天然的弹性，去中心化，开放的特点。一个P2P网络架构的典型例子就是早期的互联网本身，那时，基于IP网络之上的节点都是平等的。如今的互联网架构变得更加层次化了，但是网络互联协议仍然保持了它的扁平拓扑的本质。除了比特币，最大最成功的P2P技术的应用应该就是文件分享了，包括作为先锋的Napster，以及作为架构最新演化的BitTorrent。

比特币的P2P网络架构不仅仅是拓扑结构的选择。比特币是一个特意设计的点对点的数字货币系统，网络架构既是其核心特性的反映，也是其特性的基础。去中心化控制是其核心设计原则，只有通过扁平的、去中心化的P2P共识网络才能被实现和维护。

名词“比特币网络”是指运行比特币P2P协议的所有节点的集合。除了比特币P2P协议，还有其他协议存在，比如Strtum协议，用于挖矿以及轻量级或移动钱包。这些额外的协议由网格路由服务器提供，这些服务器自身使用比特币P2P协议接入比特币网络，通过提供网关功能，将网络扩展到那些运行其他协议的节点。比如，Stratum服务器通过Stratum协议将Stratum挖矿节点与主比特币网络相连，将Stratum协议桥接至比特币P2P协议上。我们使用名词“扩展比特币网络”指代包含比特币P2P协议，矿池挖矿协议，Stratum协议，以及其他用于连接比特币系统组件的协议的整个网络。

#节点类型与角色

虽然在比特币网络中的节点是平等的，但基于他们支持的功能，他们可能充当了不同的角色。一个比特币节点是一系列功能的集合：路由，区块链数据库，挖矿，钱包服务。一个完全节点拥有全部四个功能，如图6-1。

![figure 6-1](fig6-1.png)

*图6-1 比特币网络节点，拥有所有四项功能：钱包，挖矿，全量区块链数据库，网络路由*

所有节点均带有路由功能使其得以加入网络，可能还含有别的功能。所有节点验证并传播交易和区块，发现并维护与其他节点的连接。在完全节点的例子中（**图6-1**），路由功能用橘色圆圈标出，成为“网络路由节点”。

有些节点被称为完全节点，还维护一份完整的最新的区块链副本。完全节点可以不依赖外部而自主权威的验证任何交易。某些节点只维护区块链的一个子集，它们验证交易需要用到一个叫做*简单支付验证（simplified payment verification，SPV）*的方法。这些节点也称之为SPV或轻量级节点。在完全节点的示例图中，完全节点的区块链数据库功能用蓝色圆圈标识，称之为“完全区块链”。在**图6-3**中，SPV节点没有用篮圈标识，显示它们没有区块链的全量副本。
